<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Following_Followers</title>
    <link rel="stylesheet" type="text/css" href="css/reset.css">
    <link rel="stylesheet" type="text/css" href="css/following.css">
    <link rel="stylesheet" type="text/css" href="font-awesome-4.7.0/css/font-awesome.min.css">
    <script type="text/JavaScript" src="js/jquery3-3-1.js"></script>
</head>
<body>
    <header>
        <nav>
            <div class="pull-left">
                <ul>
                    <li class="logo"><a href="#">MyBlog</a></li>
                </ul>
            </div>
            <div class="pull-right">
                <ul>
                    <li>
                        <div class="search-bar">
                            <input type="text" style="float: left" class="input-search" placeholder="搜博主/文章">
                            <a href="#" style="float: right" class="btn-search"><i id="search_button" class="fa fa-search" aria-hidden="true"></i></a>
                        </div>
                    </li>
                    <!--<li><a class="write_blog" href="#"><i class="fa fa-pencil" aria-hidden="true"></i>  写博客</a></li>-->
                    <li class="login-center">
                        <a href="#" id="navAvatar">
                            <!--<img src="img/login.png">-->
                        </a>
                        <div class="user-control">
                            <!--<div>-->
                            <!--<a href="#" target="_blank">我的博客</a>-->
                            <!--</div>-->
                            <!--<div>-->
                            <!--<a href="#" target="_blank" class="follow-fan">关注/粉丝</a>-->
                            <!--</div>-->
                            <!--<div>-->
                            <!--<a href="#" target="_blank" class="edit-info">修改资料</a>-->
                            <!--</div>-->

                            <!--<div>-->
                            <!--<a href="#" target="_blank">退出</a>-->
                            <!--</div>-->
                        </div>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

<div class="banner">
    <div class="title-box">
        <h6 class="title-blog">Elenore的博客</h6>
    </div>
</div>

<div class="container">
    <aside>
        <div id="asideProfile" class="aside-box">
            <h3 class="aside-title">
                个人资料
            </h3>
            <div class="profile-intro">
                <div class="avatar-box">
                    <a href="#" id="userAvatar">
                        <!--头像-->
                        <!--<img src="img/login.png">-->
                    </a>
                </div>
                <div class="user-info">
                    <p class="name">
                        <!--id-->
                        <a href="#" target="_blank" class="text-truncate" id="uid">
                            Elenore
                        </a>
                    </p>
                </div>
            </div>

            <div class="data-info">
                <dl class="text-center" title="4">
                    <dt>文章</dt>
                    <dd>
                        <span class="count">4</span>
                    </dd>
                </dl>
                <dl class="text-center" title="0">
                    <dt>粉丝</dt>
                    <dd>
                        <span class="count">0</span>
                    </dd>
                </dl>
                <dl class="text-center" title="0">
                    <dt>关注</dt>
                    <dd>
                        <span class="count">0</span>
                    </dd>
                </dl>
                <dl class="text-center" title="0">
                    <dt>评论</dt>
                    <dd>
                        <span class="count">0</span>
                    </dd>
                </dl>
            </div>

            <div class="grade-box">
                访问：4396
            </div>

        </div>

        <div id="asideCategory" class="aside-box">
            <h3 class="aside-title">个人分类</h3>
            <div class="aside-content">
                <ul id="cateUl">
                    <!--<li>-->
                    <!--<a href="#">nlp<span class="count">2篇</span></a>-->

                    <!--</li>-->
                    <!--<li>-->
                    <!--<a href="#">deep learning<span class="count">3篇</span></a>-->

                    <!--</li>-->
                </ul>
            </div>
        </div>

        <div id="asideArchive" class="aside-box">
            <h3 class="aside-title" >归档</h3>
            <div class="aside-content">
                <ul class="achieve-list" id="dateSortNum">
                    <!--<li><a href="#">2018年5月<span class="count">4篇</span></a></li>-->
                    <!--<li><a href="#">2018年4月<span class="count">1篇</span></a></li>-->
                </ul>
            </div>
        </div>
        <div id="asideHotArticle" class="aside-box">
            <h3 class="aside-title">热门文章</h3>
            <div class="aside-content">
                <ul class="hotArticle-list" id="hotArticleUl">
                    <!--<li>-->
                    <!--<a href="#">Title1</a>-->
                    <!--<p class="read">阅读量：233</p>-->
                    <!--</li>-->
                    <!--<li>-->
                    <!--<a href="#">Title2</a>-->
                    <!--<p class="read">阅读量：233</p>-->
                    <!--</li>-->
                    <!--<li>-->
                    <!--<a href="#">Title0</a>-->
                    <!--<p class="read">阅读量：233</p>-->
                    <!--</li>-->
                </ul>
            </div>
        </div>

    </aside>
    <main>
        <div class="filter-box">
            <h3><a href="#">关注</a> | <a class="active" href="#">粉丝</a></h3>
            <div class="follow-data-div">
                <span class="follow-data">全部关注：233</span>
            </div>
        </div>
        <div class="follow-list">
            <!--<div class="follow-item-box">-->
                <!--<a href="#" class="follow-avatar">-->
                    <!--<img src="img/login.png">-->
                <!--</a>-->
                <!--<div class="follow-info">-->
                    <!--<div class="follow-info-top">-->
                        <!--<a href="#">-->
                            <!--<span class="follow-name">Elenore</span>-->
                        <!--</a>-->
                    <!--</div>-->
                    <!--<div class="follow-info-bottom">-->
                        <!--<span class="follow-time">关注时间：2018-5-31</span>-->
                    <!--</div>-->

                <!--</div>-->
                <!--<div class="follow-info-right">-->
                    <!--<button class="btn-follow">已关注</button>-->
                <!--</div>-->
            <!--</div>-->
            <!--<div class="follow-item-box">-->
                <!--<a href="#" class="follow-avatar">-->
                    <!--<img src="img/login.png">-->
                <!--</a>-->
                <!--<div class="follow-info">-->
                    <!--<div class="follow-info-top">-->
                        <!--<a href="#">-->
                            <!--<span class="follow-name">Elenore</span>-->
                        <!--</a>-->
                    <!--</div>-->
                    <!--<div class="follow-info-bottom">-->
                        <!--<span class="follow-time">关注时间：2018-5-31</span>-->
                    <!--</div>-->

                <!--</div>-->
                <!--<div class="follow-info-right">-->
                    <!--<button class="btn-follow">已关注</button>-->
                <!--</div>-->
            <!--</div>-->
        </div>
    </main>

</div>

<footer>
    ©myblog 2018
</footer>

<div class="backTop" onclick="">
    <i class="fa fa-arrow-up fa-3x" aria-hidden="true" ></i>
</div>

<script>
    // 回到顶部
    $(function () {
        var back=$(".backTop");
        var win=$(window);
        var sc=$(document);
        win.scroll(function () {
            if(sc.scrollTop()>=190){
                $(".backTop").fadeIn();
            }else{
                $(".backTop").fadeOut();
            }
        })
        back.click(function () {
            $('body, html').animate({scrollTop:0}, 500);
        })
    });
</script>
<script src="js/set_nav_banner.js"></script>
<script src="js/set_aside.js"></script>
<script>
    function getUrlParam(name){
        //正则表达式过滤
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        //正则规则
        // console.log("reg==="+reg);
        //search：返回URL的查询部分
        // console.log("location.search==="+location.search);
        //substr（1）：从字符串第一个位置中提取一些字符
        // console.log("location.search.substr(1)==="+location.search.substr(1));
        //match（）：在字符串内检索与正则表达式匹配的指定值，返回一个数组给r
        // console.log("window.location.search.substr(1).match(reg)==="+window.location.search.substr(1).match(reg));
        var r = window.location.search.substr(1).match(reg);
        //获取r数组中下标为2的值；（下标从0开始），用decodeURI（）进行解码
        // console.log("decodeURI(r[2])==="+decodeURI(r[2]));
        // console.log("-----------------分隔符------------------------");
        if (r != null) return decodeURI(r[2]); return null;

    }

    var username = getUrlParam('username');
    jQuery(document).ready(function () {
        $(".active").attr("href", "fans.html?username=" + username);
        $(".active").prev().attr("href", "following.html?username=" + username);
        // title 和 banner
        // title
        $("title").html(username + "的博客  -myblog");
        // banner
        var blogTitle = document.getElementsByClassName('title-box')[0];
        blogTitle.innerHTML = "<h6 class=\"title-blog\">" + username + "的博客</h6>";

        $(document).on('click', '.banner', function () {
            window.location.href = "index.html?username=" + username;
        });

        $.ajax({
            type: 'post',
            url: 'php/following.php',
            data: {
                do: 'get_fans',
                username: username
            },
            dataType: 'json',
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert('连接错误：' + textStatus + errorThrown);
            },
            success: function (data) {
                console.log(data.res);
                $(".follow-data")[0].innerHTML = "全部粉丝：" + data['fans_num'];

                for (var i = 0; i < data['fans_num']; i++){
                    if (data.res[i]['face_url'] === ""){
                        // 若传过来头像url为空则给默认
                        data.res[i]['face_url'] = "img/default.jpg";
                    }
                }
                console.log(data.res[0][2]);

                for (var i = 0; i < data['fans_num']; i++) {
                    $(".follow-list").append("<div class='follow-item-box'><a href='index.html?username=" + data.res[i][2] + "'><img style='width: 40px; height: 40px; border-radius: 50%' src='" + data.res[i]['face_url'] + "'></a>" +
                        "<div class='follow-info'><div class='follow-info-top'><a href='index.html?username=" + data.res[i][2] + "'><span class='follow-name'>" + data.res[i][2] + "</span></a></div>" +
                        "<div class='follow-info-bottom'><span class='follow-time'>被关注时间：" + data.res[i]['create_time'] + "</span></div></div></div>");
                    if (data.res[i]['is_follow'] === false){
                        $(".follow-item-box")[i].innerHTML = $(".follow-item-box")[i].innerHTML+"<div class='follow-info-right'><button class='btn-follow'>关注</button></div>"
                    }
                    else {
                        $(".follow-item-box")[i].innerHTML = $(".follow-item-box")[i].innerHTML+"<div class='follow-info-right'><button class='btn-follow'>已关注</button></div>"
                    }
                }

                // 取消关注 / 关注
                $(document).on('click', '.btn-follow', function () {
                    if (data['now_session'] === 'no_login'){
                        alert('请先登录！');
                    }
                    else {
                        // 被关注人username
                        var username = $(this).parents().prev().children().children().children().html();
                        alert(username);
                        // alert($(this).innerHTML);

                        if ($(this).html() === '已关注'){
                            // 取消关注
                            $(this).text('关注');
                            $.ajax({
                                type: 'post',
                                url: 'php/following.php',
                                data: {
                                    do: 'no_focus',
                                    username: username
                                },
                                dataType: 'json',
                                error: function (XMLHttpRequest, textStatus, errorThrown) {
                                    alert('连接错误：' + textStatus + errorThrown);
                                },
                                success: function () {
                                    alert('取消关注成功！');
                                }
                            })
                        }
                        else if ($(this).html() === '关注') {
                            // 关注
                            $(this).text('已关注');
                            $.ajax({
                                type: 'post',
                                url: 'php/following.php',
                                data: {
                                    do: 'focus',
                                    username: username
                                },
                                dataType: 'json',
                                error: function (XMLHttpRequest, textStatus, errorThrown) {
                                    alert('连接错误：' + textStatus + errorThrown);
                                },
                                success: function () {
                                    alert('关注成功！');
                                }
                            })
                        }
                    }

                });

                // 退出登录
                $(document).on('click', '.log-out', function () {
                    // alert("aa");
                    $.ajax({
                        type: 'post',
                        url: 'php/login_out.php',
                        dataType: 'json',
                        error : function (XMLHttpRequest, textStatus, errorThrown) {
                            alert('连接错误：' + textStatus + errorThrown);
                        },
                        success: function () {
                            alert('退出成功！');
                            window.location.href = 'login.html';
                        }
                    })
                });
            }


        })


    })
</script>
</body>
</html>